{"version":3,"file":"vue-render-plugin.common.js","sources":["../src/filters.js","../src/mixin.js","../src/Socket.vue","../src/Node.vue","../src/index.js"],"sourcesContent":["import Vue from 'vue';\r\n\r\nVue.filter('kebab', (str) => {\r\n    const replace = s =>  s.toLowerCase().replace(/ /g, '-');\r\n\r\n    return Array.isArray(str) ?  str.map(replace) : replace(str);\r\n});","export default {\r\n    props: ['node', 'editor', 'bindSocket', 'bindControl'],\r\n    methods: {\r\n        inputs() {\r\n            return Array.from(this.node.inputs.values())\r\n        },\r\n        outputs() {\r\n            return Array.from(this.node.outputs.values())\r\n        },\r\n        controls() {\r\n            return Array.from(this.node.controls.values())\r\n        },\r\n        selected() {\r\n            return this.editor.selected.contains(this.node) ? 'selected' : '';\r\n        }\r\n    },\r\n    directives: {\r\n        socket: {\r\n            bind(el, binding, vnode) {\r\n                vnode.context.bindSocket(el, binding.arg, binding.value);\r\n            },\r\n            update(el, binding, vnode) {\r\n                vnode.context.bindSocket(el, binding.arg, binding.value);\r\n            }\r\n        },\r\n        control: {\r\n            bind(el, binding, vnode) {\r\n                if (!binding.value) return;\r\n\r\n                vnode.context.bindControl(el, binding.value);\r\n            }\r\n        }\r\n    }\r\n}","<template lang=\"pug\">\r\n.socket(\r\n  :class=\"[type, socket.name] | kebab\",\r\n  :title=\"socket.name\"\r\n)\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: ['type', 'socket']\r\n}\r\n</script>\r\n\r\n<style lang=\"sass\" scoped>\r\n@import \"./vars\"\r\n\r\n.socket\r\n  display: inline-block\r\n  cursor: pointer\r\n  border: 1px solid white\r\n  border-radius: $socket-size/2.0\r\n  width: $socket-size\r\n  height: $socket-size\r\n  margin: $socket-margin\r\n  vertical-align: middle\r\n  background: $socket-color\r\n  z-index: 2\r\n  box-sizing: border-box\r\n  &:hover\r\n    border-width: 4px\r\n  &.multiple\r\n    border-color: yellow\r\n  &.output\r\n    margin-right: - $socket-size / 2\r\n  &.input\r\n    margin-left: - $socket-size / 2\r\n</style>\r\n","<template lang=\"pug\">\r\n.node(:class=\"[selected(), node.name] | kebab\")\r\n  .title {{node.name + 'PEPE'}}\r\n\r\n  // Outputs\r\n  .output(v-for='output in outputs()' :key=\"output.key\")\r\n    .output-title {{output.name}}\r\n    Socket(v-socket:output=\"output\", type=\"output\", :socket=\"output.socket\")\r\n\r\n  // Controls\r\n  .control(\r\n    v-for='control in controls()',\r\n    v-control=\"control\"\r\n  )\r\n\r\n  // Inputs\r\n  .input(v-for='input in inputs()' :key=\"input.key\")\r\n    Socket(v-socket:input=\"input\", type=\"input\", :socket=\"input.socket\")\r\n    .input-title(v-show='!input.showControl()') {{input.name}}\r\n    .input-control(\r\n      v-show='input.showControl()'\r\n      v-control=\"input.control\"\r\n    )\r\n</template>\r\n\r\n<script>\r\nimport mixin from './mixin';\r\nimport Socket from './Socket.vue';\r\n\r\nexport default {\r\n  mixins: [mixin],\r\n  components: {\r\n    Socket\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"sass\" scoped>\r\n@import \"./vars\"\r\n\r\n.node\r\n  background: $node-color\r\n  border: 2px solid #4e58bf\r\n  border-radius: 10px\r\n  cursor: pointer\r\n  min-width: $node-width\r\n  height: auto\r\n  padding-bottom: 6px\r\n  box-sizing: content-box\r\n  position: relative\r\n  user-select: none\r\n  &:hover\r\n    background: lighten($node-color,4%)\r\n  &.selected\r\n    background: $node-color-selected\r\n    border-color: #e3c000\r\n  .title\r\n    color: white\r\n    font-family: sans-serif\r\n    font-size: 18px\r\n    padding: 8px\r\n  .output\r\n    text-align: right\r\n  .input\r\n    text-align: left\r\n  .input-title,.output-title\r\n    vertical-align: middle\r\n    color: white\r\n    display: inline-block\r\n    font-family: sans-serif\r\n    font-size: 14px\r\n    margin: $socket-margin\r\n    line-height: $socket-size\r\n  .input-control\r\n    z-index: 1\r\n    width: calc(100% - #{$socket-size + 2*$socket-margin})\r\n    vertical-align: middle\r\n    display: inline-block\r\n  .control\r\n    padding: $socket-margin $socket-size/2 + $socket-margin\r\n</style>","import './filters';\r\nimport Node from './Node.vue';\r\nimport Socket from './Socket.vue';\r\nimport Vue from 'vue';\r\nimport mixin from './mixin';\r\n\r\nfunction createVue(el, vueComponent, vueProps) {\r\n    const app = new Vue({\r\n        render: h => h(vueComponent, { props: vueProps })\r\n    });\r\n\r\n    const nodeEl = document.createElement('div');\r\n\r\n    el.appendChild(nodeEl);\r\n    app.$mount(nodeEl);\r\n    \r\n    return app;\r\n}\r\n\r\nfunction createNode(editor, { el, node, component, bindSocket, bindControl }) {\r\n    const vueComponent = component.component || Node;\r\n    const vueProps = { ...component.props, node, editor, bindSocket, bindControl };\r\n    const app = createVue(el, vueComponent, vueProps);\r\n\r\n    node.vueContext = app.$children[0];\r\n\r\n    return app;\r\n}\r\n\r\nfunction createControl(editor, { el, control }) {\r\n    const vueComponent = control.component;\r\n    const vueProps = { ...control.props, getData: control.getData.bind(control), putData: control.putData.bind(control) };\r\n    const app = createVue(el, vueComponent, vueProps);\r\n\r\n    control.vueContext = app.$children[0];\r\n\r\n    return app;\r\n}\r\n\r\nconst update = (entity) => {\r\n    return new Promise((res) => {\r\n        if (entity.vueContext)\r\n            entity.vueContext.$forceUpdate();\r\n        entity.vueContext.$nextTick(res);\r\n    });\r\n}\r\n\r\nfunction install(editor, params) {\r\n    editor.on('rendernode', ({ el, node, component, bindSocket, bindControl }) => {\r\n        if (component.render && component.render !== 'vue') return;\r\n        node._vue = createNode(editor, { el, node, component, bindSocket, bindControl });\r\n        node.update = async () => await update(node);\r\n    });\r\n\r\n    editor.on('rendercontrol', ({ el, control }) => {\r\n        if (control.render && control.render !== 'vue') return;\r\n        control._vue = createControl(editor, { el, control });\r\n        control.update = async () => await update(control)\r\n    });\r\n\r\n    editor.on('connectioncreated connectionremoved', connection => {\r\n        update(connection.output.node)\r\n        update(connection.input.node)\r\n    });\r\n\r\n    editor.on('nodeselected', () => {\r\n        editor.nodes.map(update);\r\n    });\r\n}\r\n\r\nexport default {\r\n    name: 'vue-render',\r\n    install,\r\n    mixin,\r\n    Node,\r\n    Socket\r\n}\r\n"],"names":["Vue","filter","str","replace","s","toLowerCase","Array","isArray","map","props","methods","inputs","from","node","values","outputs","controls","selected","editor","contains","directives","socket","bind","el","binding","vnode","context","bindSocket","arg","value","update","control","bindControl","createVue","vueComponent","vueProps","app","render","h","nodeEl","document","createElement","appendChild","$mount","createNode","component","Node","vueContext","$children","createControl","getData","putData","entity","Promise","res","$forceUpdate","$nextTick","install","params","on","_vue","connection","output","input","nodes","name","mixin","Socket"],"mappings":"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"}